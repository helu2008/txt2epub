<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>TXT to EPUB</title>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
</head>
<body>
  <h1>TXT to EPUB</h1>
  <button id="login">Login</button>
  <input type="file" id="file" accept=".txt">
  <button id="upload">Upload & Convert</button>

  <script>
    const firebaseConfig = {
  apiKey: "AIzaSyDTbJ4ijjEIPtId1T8cLLijU3gbej-x9IU",
  authDomain: "txt2epub-d9378.firebaseapp.com",
  projectId: "txt2epub-d9378",
  storageBucket: "txt2epub-d9378.firebasestorage.app",
  messagingSenderId: "885899986091",
  appId: "1:885899986091:web:1bdf7ff0ca23a6b3fe63ee"
};

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();

    let idToken = null;

    document.getElementById("login").onclick = async () => {
      const provider = new firebase.auth.GoogleAuthProvider();
      const result = await auth.signInWithPopup(provider);
      idToken = await result.user.getIdToken();
      alert("Login success!");
    };

    document.getElementById("upload").onclick = async () => {
      const fileInput = document.getElementById("file");
      if (!fileInput.files.length || !idToken) {
        alert("Login and select file first");
        return;
      }

      const formData = new FormData();
      formData.append("file", fileInput.files[0]);

      const res = await fetch("https://cold-hat-4018.hengweilu0104.workers.dev/", {
        method: "POST",
        headers: {
          "Authorization": "Bearer " + idToken
        },
        body: formData
      });

      if (!res.ok) {
        alert("Error: " + res.status);
        return;
      }

      const blob = await res.blob();
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "converted.epub";
      a.click();
    };
  </script>
</body>
</html>
